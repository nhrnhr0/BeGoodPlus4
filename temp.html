<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
  </head>
  <body>
    <div id="result"></div>
    <table id="result-table">
      <thead>
        <tr>
          <th>שם</th>
          <th>סטטוס</th>
        </tr>
      </thead>
      <tbody id="result-tbody"></tbody>
    </table>

    <script>
      function track_progress() {
        google.script.run
          .withSuccessHandler(got_ids_from_sheets)
          .withFailureHandler(showError)
          .get_ids_to_update();
      }

      function got_ids_from_sheets(data) {
        let index = data.index;
        let ids = data.ids;
        document.getElementById("result").innerHTML =
          "Got " + (index + 1) + " out of" + ids.length + " ids from sheets";
        document.getElementById("result-tbody").innerHTML = "";
        for (var i = 0; i < ids.length; i++) {
          let name = ids[i]?.title;
          let status = ids[i]?.status;
          document.getElementById("result-tbody").innerHTML +=
            "<tr><td>" + name + "</td><td>" + status + "</td></tr>";
        }
      }

      function showError() {
        document.getElementById("result").innerHTML = "Error: " + message;
      }

      setInterval(track_progress, 1000);
    </script>
    <style>
      body {
        direction: rtl;
      }
    </style>
  </body>
</html>
